<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../assets/img/logo-fav.png">
    <title>Ready Player One: the Capital Game</title>
    <link rel="stylesheet" type="text/css" href="../assets/lib/perfect-scrollbar/css/perfect-scrollbar.min.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/lib/material-design-icons/css/material-design-iconic-font.min.css"/>

    <link rel="stylesheet" type="text/css" href="../assets/lib/jquery.vectormap/jquery-jvectormap-1.2.2.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/lib/jqvmap/jqvmap.min.css"/>
    <link rel="stylesheet" type="text/css" href="../assets/lib/select2/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/lib/bootstrap-slider/css/bootstrap-slider.min.css">

    <!--[if lt IE 9]>
    <link rel="stylesheet" type="text/css" href="../assets/lib/datetimepicker/css/bootstrap-datetimepicker.min.css"/>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="../assets/lib/jquery.gritter/css/jquery.gritter.css"/>
    <link rel="stylesheet" href="../assets/css/app.css" type="text/css"/>

    <!-- <script src="assets/js/nebulas.js"></script> -->
    <!-- <script src="assets/js/nebPay.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/nebulas@0.5.0/dist/nebulas.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/nebulasio/nebPay@60c65f8a7e26015bb31c56d56f3a638a33ea3c8e/dist/nebPay.min.js"></script>
    <script src="../assets/js/mustache.min.js"></script>
    <script src="../assets/js/bignumber.min.js"></script>
    <script src="../assets/js/config.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="../assets/js/ga.js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-119584347-3');

    if(window.location.search.match('lang=en')){
      localStorage.setItem('lang', 'en');
    }

  </script>
  </head>
  <body>
    <div class="be-wrapper be-offcanvas-menu be-fixed-sidebar">
      <nav class="navbar navbar-expand fixed-top be-top-header">
        <div class="container-fluid">
          <div class="be-navbar-header"><a href="#" class="nav-link be-toggle-left-sidebar"><span class="icon mdi mdi-menu"></span></a><a href="index.html" class="navbar-brand"></a>
          </div>
          <div class="be-right-navbar">
            <ul class="nav navbar-nav float-right be-user-nav">
              <li class="nav-item dropdown"><a href="#" data-toggle="dropdown" role="button" aria-expanded="false" class="nav-link dropdown-toggle"><img src="../assets/img/avatar0.png" alt="Avatar" id="avatarImg"><span class="user-name">Player #</span></a>
                <div role="menu" class="dropdown-menu">
                  <div class="user-info">
                    <div class="user-name"> Player #</div>
                    <div class="user-position offline" id="showWalletStatus">No NasExtWallet</div>
                  </div>
                  <a class="dropdown-item"><span class="icon mdi mdi-money"></span> NAS Balance<b id="accountBalance"></b></a>
                  <a class="dropdown-item"><span class="icon mdi mdi-money"></span> CGT Balance<b id="accountTokenBalance"></b></a>
                  <a class="dropdown-item"><span class="icon mdi mdi-money-box"></span> Reserve NAS<b id="contractBalance"></b></a>
                  <a class="dropdown-item"><span class="icon mdi mdi-money-box"></span> Guarantee NAS<b id="contractInsureBalance"></b></a>
                  <a class="dropdown-item"><span class="icon mdi mdi-money-box"></span> Contract CGT <b id="contractTokenBalance"></b></a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" id="playerData"><span class="icon mdi mdi-account"></span>Game Analysis</a>
                  <a class="dropdown-item" onclick="login()" id="loginbtn"><span class="icon mdi mdi-key"></span> Login</a>
                </div>
              </li>
            </ul>
            <div class="page-title"><span>Ready Player One: the Capital Game</span></div>
            <ul class="nav navbar-nav float-right be-icons-nav">
              <li class="nav-item dropdown"><a href="../index.html?lang=zh" role="button" aria-expanded="false" class="nav-link be-toggle-right-sidebar">中文</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <div class="be-left-sidebar">
        <div class="left-sidebar-wrapper"><a href="#" class="left-sidebar-toggle">Menu</a>
          <div class="left-sidebar-spacer">
            <div class="left-sidebar-scroll">
              <div class="left-sidebar-content">
                <ul class="sidebar-elements">
                  <li class="divider">Menu</li>
                  <li><a href="index.html"><i class="icon mdi mdi-home"></i><span>Dashboard</span></a>
                  </li>
                  <li class="parent"><a><i class="icon mdi mdi-8tracks"></i><span>Related Resource</span></a>
                    <ul class="sub-menu">
                      <li><a href="../assets/file/whitepaper.pdf" target="_blank">Whitepaper</a>
                      </li>
                      <li><a href="https://nebulas.io/" target="_blank">Nebulas Official Website</a>
                      </li>
                      <li><a href="https://explorer.nebulas.io/#/" target="_blank">Nebulas Blockchain Explore</a>
                      </li>
                      <li><a href="https://github.com/nebulasio/WebExtensionWallet" target="_blank">NasExtWallet</a>
                      </li>
                      <li><a href="https://nano.nebulas.io" target="_blank">NAS nano</a>
                      </li>
                      <li><a href="https://github.com/dabdevelop/capitalgame" target="_blank">GitHub Source</a>
                      </li>
                      <li><a href="#" target="_blank" id="contract">Contract Address</a>
                      </li>
                    </ul>
                  </li>
                  <li class="parent"><a href="http://foxythemes.net/preview/products/beagle/charts.html"><i class="icon mdi mdi-email"></i><span>Contact Us</span></a>
                    <ul class="sub-menu">
                      <li><a href="mailto:ft.nudt@gmail.com">Email</a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="progress-widget">
            <div class="progress-data"><span class="progress-value">0%</span><span class="name">Game Progress</span></div>
            <div class="progress mb-4">
              <div role="progressbar" style="width: 0%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" class="progress-bar bg-primary progress-bar-striped progress-bar-animated" id="progressCirculation"></div>
              <div role="progressbar" style="width: 0%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" class="progress-bar bg-danger progress-bar-striped" id="progressTotalSupply"></div>
            </div>

            <!--<div class="progress">-->
            <!--<div style="width: 0%;" class="progress-bar progress-bar-primary"></div>-->
            <!--</div>-->
          </div>
        </div>
      </div>

      <div class="be-content">


        <div class="main-content container-fluid">
          <div class="row">
            <div class="col-12 col-lg-6 col-xl-3">
              <div class="widget widget-tile">
                <div id="spark1" class="chart sparkline"><canvas width="85" height="35" style="display: inline-block; width: 85px; height: 35px; vertical-align: top;"></canvas></div>
                <div class="data-info">
                  <div class="desc">Player Number</div>
                  <div class="value"><span class="indicator indicator-positive mdi mdi-chevron-up"></span><span data-toggle="counter" data-start="0" data-end="0" class="number" id="playerNum">0</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6 col-xl-3">
              <div class="widget widget-tile">
                <div id="spark2" class="chart sparkline"><canvas width="81" height="35" style="display: inline-block; width: 81px; height: 35px; vertical-align: top;"></canvas></div>
                <div class="data-info">
                  <div class="desc">CGT Circulation</div>
                  <div class="value"><span class="indicator indicator-positive mdi mdi-chevron-up"></span><span data-toggle="counter" data-start="0" data-end="0" class="number" id="circulation">0</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6 col-xl-3">
              <div class="widget widget-tile">
                <div id="spark3" class="chart sparkline"><canvas width="85" height="35" style="display: inline-block; width: 85px; height: 35px; vertical-align: top;"></canvas></div>
                <div class="data-info">
                  <div class="desc">CGT Volume</div>
                  <div class="value"><span class="indicator indicator-positive mdi mdi-chevron-up"></span><span data-toggle="counter" data-start="0" data-end="0" class="number" id="volume">0</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-6 col-xl-3">
              <div class="widget widget-tile">
                <div id="spark4" class="chart sparkline"><canvas width="85" height="35" style="display: inline-block; width: 85px; height: 35px; vertical-align: top;"></canvas></div>
                <div class="data-info">
                  <div class="desc">CGT Market Cap (NAS)</div>
                  <div class="value"><span class="indicator indicator-positive mdi mdi-chevron-up"></span><span data-toggle="counter" data-start="0" data-end="0" class="number" id="marketCap">0</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="row">
            <div class="col-md-12">
              <div class="widget widget-fullwidth be-loading">
                <div class="widget-head">
                </div>
                <div class="widget-chart-container">
                  <div class="widget-chart-info">
                    <ul class="chart-legend-horizontal">
                      <li><span data-color="main-chart-color1" style="background-color: rgb(66, 133, 244);"></span>Buy Price (10 ^ -6 NAS)</li>
                    </ul>
                  </div>
                  <div id="main-chart" style="height: 260px; padding: 0px; position: relative;"><canvas class="flot-base" width="1904" height="520" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 952px; height: 260px;"></canvas><canvas class="flot-overlay" width="1904" height="520" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 952px; height: 260px;"></canvas></div>
                </div>
                <div class="be-spinner">
                  <svg width="40px" height="40px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                    <circle fill="none" stroke-width="4" stroke-linecap="round" cx="33" cy="33" r="30" class="circle"></circle>
                  </svg>
                </div>
              </div>
            </div>
          </div> -->

        <div class="row">
          <div class="col-12 col-lg-3">
            <div class="card card-border-color card-border-color-infor">
            <div class="widget be-loading">
              <div class="widget-head">
                <div class="title">Partitions of Contract NAS</div>
              </div>
              <div class="widget-chart-container">
                <div id="top-sales" style="height: 120px; padding: 0px; position: relative;"><canvas class="flot-base" width="514" height="356" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 257.328px; height: 178px;"></canvas><canvas class="flot-overlay" width="514" height="356" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 257.328px; height: 178px;"></canvas></div>
                <div class="chart-pie-counter text-sm-center"></div>
              </div>
              <div class="chart-legend">
                <table>
                  <tbody><tr>
                    <td class="chart-legend-color"><span data-color="top-sales-color1" style="background-color: rgb(52, 168, 83);"></span></td>
                    <td>Contract Reserve NAS</td>
                    <td class="chart-legend-value" id="balance">0</td>
                  </tr>
                  <tr>
                    <td class="chart-legend-color"><span data-color="top-sales-color2" style="background-color: rgb(251, 188, 5);"></span></td>
                    <td>Contract Guarantee NAS</td>
                    <td class="chart-legend-value" id="insureBalance">0</td>
                  </tr>
                  </tbody></table>
              </div>
              <div class="be-spinner">
                <svg width="40px" height="40px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                  <circle fill="none" stroke-width="4" stroke-linecap="round" cx="33" cy="33" r="30" class="circle"></circle>
                </svg>
              </div>
            </div>
            </div>
          </div>


          <div class="col-lg-3">
            <div class="card card-border-color card-border-color-danger">
              <div class="card-header card-header-divider">Burn<span class="card-subtitle" id="burnPrice">Burn Price</span></div>
              <div class="card-body">
                <div class="form-group input-group-sm">
                    <label for="burnAmount" class="col-form-label text-right">Burn Amount</label><br><br>
                    <input id="burnAmount" type="number" step="0.01" placeholder="Amount" class="form-control">
                </div>
                <div class="row pt-3">
                  <button type="submit" onclick="getBurnOrder()" class="btn btn-rounded btn-block btn-danger md-trigger" style="float: right;" data-modal="form-burn">Burn</button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3">
            <div class="card card-border-color card-border-color-success">
              <div class="card-header card-header-divider">Buy<span class="card-subtitle" id="buyPrice">Buy Price</span></div>
              <div class="card-body">
                <div class="form-group input-group-sm">
                    <label for="buyValue" class="col-form-label text-right">Buy Value</label><br><br>
                    <input id="buyValue" type="number" step="0.001" placeholder="Value" class="form-control">
                </div>
                <div class="row pt-3">
                  <button type="submit" onclick="getBuyOrder()" class="btn btn-rounded btn-block btn-success md-trigger" data-modal="form-buy">Buy</button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3">
            <div class="card card-border-color card-border-color-danger">
              <div class="card-header card-header-divider">Sell<span class="card-subtitle" id="sellPrice">Sell Price</span></div>
              <div class="card-body">
                <div class="form-group input-group-sm">
                    <label for="sellAmount" class="col-form-label text-right">Sell Amount</label><br><br>
                    <input id="sellAmount" type="number" step="0.01" placeholder="Amount" class="form-control">
                </div>
                <div class="row pt-3">
                  <button type="submit" onclick="getSellOrder()" class="btn btn-rounded btn-block btn-danger md-trigger"  data-modal="form-sell">Sell</button>
                </div>
              </div>
            </div>
          </div>

        </div>


          <div class="row">
            <div class="col-12 col-lg-6">
              <div class="card card-table">
                <div class="card-header">
                  <div class="title">Buy</div>
                </div>
                <div class="card-body table-responsive">
                  <table class="table table-striped table-borderless">
                    <thead>
                    <tr>
                      <th style="width:30%;">Player</th>
                      <th class="number">Amount</th>
                      <th class="number">Price (NAS)</th>
                      <th style="width:30%;">Time</th>
                      <th style="width:5%;" class="actions"></th>
                    </tr>
                    </thead>
                    <tbody class="no-border-x" id="buyOrder">
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-6">
              <div class="card card-table">
                <div class="card-header">
                  <div class="title">Sell</div>
                </div>
                <div class="card-body table-responsive">
                  <table class="table table-striped table-borderless">
                    <thead>
                    <tr>
                      <th style="width:30%;">Player</th>
                      <th class="number">Amount</th>
                      <th class="number">Price(NAS)</th>
                      <th style="width:30%;">Time</th>
                      <th style="width:5%;" class="actions"></th>
                    </tr>
                    </thead>
                    <tbody class="no-border-x" id="sellOrder">
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Nifty Modal-->
          <div id="form-burn" class="modal-container colored-header colored-header-danger custom-width modal-effect-9">
            <div class="modal-content">
              <div class="modal-header modal-header-colored">
                <h3 class="modal-title">Please Confirm the Order</h3>
                <button type="button" data-dismiss="modal" aria-hidden="true" class="close modal-close"><span class="mdi mdi-close"></span></button>
              </div>
              <div class="modal-body form">
                <div class="form-group">
                  <label id="burnLabel">Burn CGT</label>
                  <input type="number" class="form-control" disabled="disabled" id="burnAmountConfirm">
                </div>
                <div class="form-group">
                  <label>Get NAS</label>
                  <input type="number" class="form-control" disabled="disabled" id="burnValueConfirm">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-secondary modal-close" onclick="burnCancel()" id="burnBtnCancel">Cancel</button>
                <button type="button" data-dismiss="modal" class="btn btn-success modal-close" disabled="disabled" onclick="burn()" id="burnBtnConfirm">Confirm</button>
              </div>
            </div>
          </div>

          <!-- Nifty Modal-->
          <div id="form-sell" class="modal-container colored-header colored-header-danger custom-width modal-effect-9">
            <div class="modal-content">
              <div class="modal-header modal-header-colored">
                <h3 class="modal-title">Please Confirm the Order</h3>
                <button type="button" data-dismiss="modal" aria-hidden="true" class="close modal-close"><span class="mdi mdi-close"></span></button>
              </div>
              <div class="modal-body form">
                <div class="form-group">
                  <label id="sellLabel">Sell CGT</label>
                  <input type="number" class="form-control" disabled="disabled" id="sellAmountConfirm">
                </div>
                <div class="form-group">
                  <label>Get NAS</label>
                  <input type="number" class="form-control" disabled="disabled" id="sellValueConfirm">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-secondary modal-close" onclick="sellCancel()" id="sellBtnCancel">Cancel</button>
                <button type="button" data-dismiss="modal" class="btn btn-success modal-close" disabled="disabled" onclick="sell()" id="sellBtnConfirm">Confirm</button>
              </div>
            </div>
          </div>

          <!-- Nifty Modal-->
          <div id="form-buy" class="modal-container colored-header colored-header-success custom-width modal-effect-9">
            <div class="modal-content">
              <div class="modal-header modal-header-colored">
                <h3 class="modal-title">Please Confirm the Order</h3>
                <button type="button" data-dismiss="modal" aria-hidden="true" class="close modal-close"><span class="mdi mdi-close"></span></button>
              </div>
              <div class="modal-body form">
                <div class="form-group">
                  <label id="buyLabel">Buy CGT</label>
                  <input type="number" class="form-control" disabled="disabled" id="buyAmountConfirm">
                </div>
                <div class="form-group">
                  <label>Pay NAS</label>
                  <input type="number" class="form-control" disabled="disabled" id="buyValueConfirm">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-secondary modal-close" onclick="buyCancel()" id="buyBtnCancel">Cancel</button>
                <button type="button" data-dismiss="modal" class="btn btn-success modal-close" disabled="disabled" onclick="buy()" id="buyBtnConfirm">Confirm</button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <script src="../assets/lib/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="../assets/lib/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
    <script src="../assets/lib/bootstrap/dist/js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery.nestable/jquery.nestable.js" type="text/javascript"></script>
    <script src="../assets/lib/moment.js/min/moment.min.js" type="text/javascript"></script>
    <script src="../assets/lib/datetimepicker/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    <script src="../assets/lib/select2/js/select2.min.js" type="text/javascript"></script>
    <script src="../assets/lib/select2/js/select2.full.min.js" type="text/javascript"></script>
    <script src="../assets/lib/bootstrap-slider/bootstrap-slider.min.js" type="text/javascript"></script>

    <script src="../assets/js/app.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/jquery.flot.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/jquery.flot.pie.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/jquery.flot.time.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/jquery.flot.resize.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/plugins/jquery.flot.orderBars.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/plugins/curvedLines.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-flot/plugins/jquery.flot.tooltip.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery.sparkline/jquery.sparkline.min.js" type="text/javascript"></script>
    <script src="../assets/lib/countup/countUp.min.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="../assets/lib/jqvmap/jquery.vmap.min.js" type="text/javascript"></script>
    <script src="../assets/lib/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
    <script src="../assets/lib/prettify/prettify.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery.gritter/js/jquery.gritter.js" type="text/javascript"></script>
    <script src="../assets/lib/jquery.niftymodals/dist/jquery.niftymodals.js" type="text/javascript"></script>

    <script type="text/javascript">

      $.ajaxSetup({
        cache: false
      });

      'use strict';

      var Nebulas = require("nebulas");
      var Account = Nebulas.Account;
      var Transaction = Nebulas.Transaction;
      var Utils = Nebulas.Utils;
      var Unit = Nebulas.Unit;

      //      var rpcURL = "https://testnet.nebulas.io";
      //      var dappAddress = 'n235Bs9WMYYQAuo7w3F8XrhX5DCtWbSQ6cY';
      //      var chainId = 1001;
      //      var rpcURL = "http://localhost:8685";
      var rpcURL = "https://mainnet.nebulas.io";
      var chainId = 1;
      var dappAddress = 'n1sr4JA4e9QPB4opLk2Kjmp8NkP6GGoAmnt';

      if(chainId == 1){
        $("#contract").prop('href','https://explorer.nebulas.io/#/address/'+ dappAddress +'#/').prop('target', '_blank_');
      } else {
        $("#contract").prop('href','https://explorer.nebulas.io/#/testnet/address/'+ dappAddress +'#/').prop('target', '_blank_');
      }

      var neb = new Nebulas.Neb();
      neb.setRequest(new Nebulas.HttpRequest(rpcURL));


      var needCheckNASWallet = localStorage.getItem('needCheckNASWallet') || '1';
      needCheckNASWallet = parseInt(needCheckNASWallet);
      var invoker = null;

      function checkNASWallet(_invoker) {
        invoker = _invoker;
        //to check if the extension is installed
        //if the extension is installed, var "webExtensionWallet" will be injected in to web page
        if (needCheckNASWallet && (typeof (webExtensionWallet) === "undefined")) {
          $(document).ready(function () {
            if(window.mobileAndTabletcheck()){
              $.gritter.add({
                title: "New Notice",
                text: "Please Install NAS nano on mobile device.",
                time: "",
                class_name: "warning clean"
              });
              disableCheckNASWallet();
              return true;
            } else{
              $.gritter.add({
                title: "New Notice",
                text: "No NasExtWallet, please install it.",
                time: "",
                class_name: "warning clean"
              });
            }
            return false;
          });
        }
        return true;
      }

      function disableCheckNASWallet() {
        needCheckNASWallet = false;
        localStorage.setItem('needCheckNASWallet', 0);
        if(invoker != null){
          invoker.click();
        }
      }

      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      var receiptGot = [];

      function getTransactionReceipt(hash, callback){
        $.post(rpcURL + '/v1/user/getTransactionReceipt', JSON.stringify({
          "hash": hash
        }), function (resp) {
          callback && callback(resp)
        })
      }

      function recheckTransactionReceipt(hash, callback) {
        var retry = 8;
        var retry2 = 32;
        var task = setInterval(function () {
          getTransactionReceipt(hash, function (resp) {
            retry --;
            if(retry < 0){

              try{
                neb.api.getTransactionReceipt({hash: hash}).then(function(receipt){
                  if (receipt.status == 0) //not in pending
                  {
                    clearInterval(task);
                    $.gritter.add({
                      title: "New Notice",
                      text: "Transaction fail, please set GasLimit to 2M wei or reduce the amount/value (< 1NAS), error message: " + receipt.execute_error,
                      time: "",
                      class_name: "danger clean"
                    });
                  } else if (receipt.status == 2) {
                    retry2 --;
                    if(retry2 < 0){
                      clearInterval(task);
                      $.gritter.add({
                        title: "New Notice",
                        text: "Query the transaction status failed, please check it manually.",
                        time: "",
                        class_name: "warning clean"
                      });
                    }
                  } else {
                    clearInterval(task);
                    callback && callback(resp.result);
                  }
                });
              } catch(err){
                console.log(err);
              }
            }
            var status = resp.result.status;
            if(status == 1){
              clearInterval(task);
              if(!receiptGot.includes(resp.result.hash)){
                receiptGot.push(resp.result.hash);
                callback && callback(resp.result);
              }
            }
          })
        }, 5000);
      }

      function innerCall(fun, args, value, callback) {
        let params = {};
        var account = Account.NewAccount();
        account.setPrivateKey(faucets[getRandomInt(0, 100)]);
        params.from = account;
        params.to = dappAddress;
        params.gasPrice = Utils.toBigNumber(1000000);
        params.gasLimit = Utils.toBigNumber(20000000);
        params.value = value;
        // prepare contract
        params.contract = {
          "function": fun,
          "args": JSON.stringify(args)
        };
//        console.log(params.from.getAddressString() + ' call ' + params.to + ' @ ' + fun + ": " + JSON.stringify(args) + ' with value: ' + value);
        callback(params);
      }

      window.mobileAndTabletcheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };

      function refresh(){
        $.gritter.add({
          title: "New Notice",
          text: "The transaction data will be refreshed in seconds.",
          time: "",
          class_name: "primary clean"
        });
        address = localStorage.getItem('address') || '';
        checkWallet();
        getPrice();
        loadPlayerAccount();
        getContractTokenBalance();
      }


      function getMobileTransactionReceipt(serialNumber, callback){
        $.get("https://pay.nebulas.io/api/mainnet/pay/query?payId=" + serialNumber, function (resp) {
          callback && callback(resp)
        })
      }

      var retryQueryTime = 10;

      function recheckMobileTransactionReceipt(serialNumber, callback) {
        retryQueryTime --;

        getMobileTransactionReceipt(serialNumber, function (resp) {
          if(resp instanceof Object){
            if(retryQueryTime <= 0){
              clearInterval(intervalQuery);
              if(resp.code == 1){
                $.gritter.add({
                  title: "New Notice",
                  text: "Query the transaction status failed, please check it manually.",
                  time: "",
                  class_name: "warning clean"
                });
                return;
              }
            }
            if (resp.code == 0 && (resp.data.status == 1 || resp.data.status == 0)) {
              clearInterval(intervalQuery);
              if(!receiptGot.includes(resp.data.hash)){
                receiptGot.push(resp.data.hash);
                callback && callback(resp.data);
              }
            }
          }

        })
      }

      var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
      var nebPay = new NebPay();
      var intervalQuery;

      function callNebPay(fun, args, value, callback) {

        if(isWx){
          $.gritter.add({
            title: "新消息",
            text: "微信浏览器可能不支持NAS nano调用, 请点击右上方的三个小点, 并选择用浏览器打开!",
            time: "",
            class_name: "warning clean"
          });
        }

        var wait;
        function clearWait() {
          clearInterval(wait);
          refresh();
        }

        var inQuery = false;

        $.gritter.add({
          title: "New Notice",
          text: "Invoking the wallet now, please set GasLimit to 2M wei or reduce the amount/value (< 1NAS) and confirm.",
          time: "",
          class_name: "primary clean"
        });
        var serialNumber;
        innerCall(fun, args, value, function (params) {
          serialNumber = nebPay.call(params.to, params.value, params.contract.function, params.contract.args, {
            qrcode: {
              showQRCode: false
            },
            callback:"https://pay.nebulas.io/api/mainnet/pay",
            listener: function (resp) {
              if(window.mobileAndTabletcheck()){
                if(!inQuery){
                  inQuery = true;
                  retryQueryTime = 10;
                  $.gritter.add({
                    title: "New Notice",
                    text: "Querying transaction status.",
                    time: "",
                    class_name: "primary clean"
                  });
                  intervalQuery = setInterval(function () {
                    recheckMobileTransactionReceipt(serialNumber, function(resp){
                      if(resp.status == 1){
                        $.gritter.add({
                          title: "New Notice",
                          text: "Transaction succeed.",
                          time: "",
                          class_name: "success clean"
                        });
                        callback && callback(resp);
                      } else if(resp.status == 0){
                        $.gritter.add({
                          title: "New Notice",
                          text: "Transaction failed, please set GasLimit to 2M wei or reduce the amount/value (< 1NAS), error message: " + resp.execute_error,
                          time: "",
                          class_name: "danger clean"
                        });
                        wait = setInterval(clearWait, 2000);
                      }
                    });
                  }, 5000);
                }
                return;
              }
              if (resp !== 'Error: Transaction rejected by user') {
                $.gritter.add({
                  title: "New Notice",
                  text: "Transaction submitted, querying the transaction status, please wait for 15 seconds.",
                  time: "",
                  class_name: "primary clean"
                });
                var hash = resp.txhash;
                recheckTransactionReceipt(hash, function (resp) {
                  $.gritter.add({
                    title: "New Notice",
                    text: "Transaction succeed.",
                    time: "",
                    class_name: "success clean"
                  });
                  callback && callback(resp);
                })
              } else {
                $.gritter.add({
                  title: "New Notice",
                  text: "You cancelled",
                  time: "",
                  class_name: "warning clean"
                });
              }

            }
          });

          var wait2;
          function clearWait2() {
            clearInterval(wait2);
            if(window.mobileAndTabletcheck() && !inQuery){
              inQuery = true;
              retryQueryTime = 15;
              $.gritter.add({
                title: "New Notice",
                text: "Querying the transaction status.",
                time: "",
                class_name: "primary clean"
              });
              intervalQuery = setInterval(function () {
                recheckMobileTransactionReceipt(serialNumber, function(resp){
                  if(resp.status == 1){
                    $.gritter.add({
                      title: "New Notice",
                      text: "Transaction succeed.",
                      time: "",
                      class_name: "success clean"
                    });
                    callback && callback(resp);
                  } else if(resp.status == 0){
                    $.gritter.add({
                      title: "New Notice",
                      text: "Transaction failed, please set GasLimit to 2M wei or reduce the amount/value (< 1NAS), error message: " + resp.execute_error,
                      time: "",
                      class_name: "danger clean"
                    });
                    wait = setInterval(clearWait, 2000);
                  }
                });
              }, 5000);
            }
          }
          wait2 = setInterval(clearWait2, 10000);

          var wait3;

          function clearWait3() {
            clearInterval(wait3);
            if (window.mobileAndTabletcheck() && inQuery) {
              $.gritter.add({
                title: "New Notice",
                text: "Querying the transaction status.",
                time: "",
                class_name: "primary clean"
              });
            }
          }

          wait3 = setInterval(clearWait3, 18000);
        });

      }

      function getPlayerNum(callback){
        var fun = 'playerNum';
        var args = [];
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
            try{
              result = JSON.parse(result);
              callback(result);
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }

          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });

      }

      function getCirculation(callback){
        var fun = 'circulation';
        var args = [];
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
            try{
              result = JSON.parse(result);
              callback(result);
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }

          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });
      }



      function getBuyVolume(callback){
        $.get('https://api.cgplayerone.com/cg/buy-list', function(result){
          buyOrder = buyOrder.concat(result);
          for(var r in result){
            volume += result[r].amount;
            buyPriceTrend.push([result[r].orderId, parseInt(result[r].price.toFixed(8) * 1000000)]);
          }
          callback()
        })
      }

      function getSellVolume(callback){
        $.get('https://api.cgplayerone.com/cg/sell-list', function(result){
          sellOrder = sellOrder.concat(result);
          for(var r in result){
            volume += result[r].amount;
            sellPriceTrend.push([result[r].orderId, parseInt(result[r].price.toFixed(8) * 1000000)]);
          }
          callback()
        })
      }
      function getBurnVolume(callback){
        $.get('https://api.cgplayerone.com/cg/burn-list', function(result){
          burnOrder = burnOrder.concat(result);
          for(var r in result){
            volume += result[r].amount;
            burnPriceTrend.push([result[r].orderId, parseInt(result[r].price.toFixed(8) * 1000000)]);
          }
          callback()
        })
      }

      function getBalance(callback){
        $.get('https://api.cgplayerone.com/cg/balance', function(result){
          callback(result)
        })
      }

      function getInsureBalance(callback){
        $.get('https://api.cgplayerone.com/cg/insure-balance', function(result){
          callback(result)
        })
      }

//
//      function getBuyVolumeByIndex(index, callback){
//        var fun = 'getBuyOrder';
//        var args = [];
//        args.push(index);
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              result = JSON.parse(result);
//              buyOrder = buyOrder.concat(result);
//              for(var r in result){
//                volume += result[r].amount;
//                buyPriceTrend.push([result[r].orderId, parseInt(result[r].price.toFixed(8) * 1000000)]);
//              }
//              callback();
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getBuyVolume(callback){
//        var fun = 'buyOrderIndex';
//        var args = [];
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              var index = JSON.parse(result);
//              var i = index;
//              // var f = function(){
//              //   i ++;
//              //   if(i <= index){
//              //     getBuyVolumeByIndex(i, f);
//              //   } else {
//              //     callback()
//              //   }
//              // };
//
//              getBuyVolumeByIndex(i, callback);
//
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getSellVolumeByIndex(index, callback){
//        var fun = 'getSellOrder';
//        var args = [];
//        args.push(index);
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              result = JSON.parse(result);
//              for(var r in result){
//                volume += result[r].amount;
//              }
//              sellOrder = sellOrder.concat(result);
//              callback();
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getSellVolume(callback){
//        var fun = 'sellOrderIndex';
//        var args = [];
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              var index = JSON.parse(result);
//              var i = index;
//              // var f = function(){
//              //   i ++;
//              //   if(i <= index){
//              //     getSellVolumeByIndex(i, f);
//              //   } else {
//              //     callback();
//              //   }
//              // };
//              getSellVolumeByIndex(i, callback);
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getBurnVolumeByIndex(index, callback){
//        var fun = 'getBurnOrder';
//        var args = [];
//        args.push(index);
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              result = JSON.parse(result);
//              burnOrder = burnOrder.concat(result);
//              callback();
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getBurnVolume(callback){
//        var fun = 'burnOrderIndex';
//        var args = [];
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//
//              var index = JSON.parse(result);
//              var i = index;
//              // var f = function(){
//              //   i ++;
//              //   if(i <= index){
//              //     getBurnVolumeByIndex(i, f);
//              //   } else {
//              //     callback();
//              //   }
//              // };
////              getBurnVolumeByIndex(i, callback);
//              callback();
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getBalance(callback){
//        var fun = 'balance';
//        var args = [];
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              var balance = JSON.parse(result);
//              callback(balance);
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }
//
//      function getInsureBalance(callback){
//        var fun = 'insureBalance';
//        var args = [];
//        innerCall(fun, args, 0, function(params){
//          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            var result = resp.result;
//            if(result === 'null' || result === '""'){
//              return;
//            }
//            try{
//              var balance = JSON.parse(result);
//              callback(balance);
//            }catch (err){
//              //result is the error message
//              console.log("error:" + err.message)
//            }
//          }).catch(function (err) {
//            console.log("error:" + err.message)
//          });
//
//        });
//      }

      function getPrice(){
        var fun = 'buy';
        var args = [];
        innerCall(fun, args, Math.pow(10, 18), function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
            try{
              var order = JSON.parse(result);
              $("#buyPrice").html(order.price.toFixed(5));
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }
          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });

        fun = 'sellPrice';
        args = [];
        args.push(0.01);
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
//            console.log(result);
            try{
              var order = JSON.parse(result);
              $("#sellPrice").html(order.price.toFixed(5));
              price = order.price.toFixed(5);
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }
          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });

        fun = 'burnPrice';
        args = [];
        args.push(0.01);
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
//            console.log(result);
            try{
              var order = JSON.parse(result);
              $("#burnPrice").html(order.price.toFixed(5));
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }
          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });
      }

      function getContractTokenBalance(){
        var fun = 'balanceOf';
        var args = [];
        args.push(dappAddress);
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            console.log(resp);
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
            try{
              var balance = JSON.parse(result);
              contractTokenBalance = parseFloat(Unit.fromBasic(balance, 'nas').toString(10)).toFixed(2);
              $("#contractTokenBalance").html(' ' + parseFloat(Unit.fromBasic(balance, 'nas').toString(10)).toFixed(2) + ' CGT');
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }
          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });
      }


      function resetPlayerInfo(){
        $("#playerId").html('');
        $("#playerTokenBalance").html('');
        $("#playerBuyAmount").html('');
        $("#playerSellAmount").html('');
        $("#playerBurnAmount").html('');
        $("#playerBuyValue").html('');
        $("#playerSellValue").html('');
        $("#playerBurnValue").html('');
        $("#playerAverageInPrice").html('');
        $("#avgPriceTh").html('');
      }


      function getPlayerInfo(account){
        console.log(account);
        $("#form-player").modal('show');
        var fun = 'player';
        var args = [];
        args.push(account);
        innerCall(fun, args, 0, function(params){
          neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
//            console.log(resp);
            var result = resp.result;
            if(result === 'null' || result === '""'){
              return;
            }
            try{
              var player = JSON.parse(result);
              console.log(player);
              $("#playerId").html(player.playerId);
              $("#playerTokenBalance").html(player.tokenBalance.toFixed(6));
              $("#playerBuyAmount").html(player.buyAmount.toFixed(6));
              $("#playerSellAmount").html(player.sellAmount.toFixed(6));
              $("#playerBurnAmount").html(player.burnAmount.toFixed(6));
              $("#playerBuyValue").html(player.buyValue.toFixed(6));
              $("#playerSellValue").html(player.sellValue.toFixed(6));
              $("#playerBurnValue").html(player.burnValue.toFixed(6));
              if(player.tokenBalance > 0){
                var playerAverageInPrice = (player.buyValue - player.sellValue - player.burnValue) / player.tokenBalance;
                if(playerAverageInPrice >= 0){
                  if(playerAverageInPrice < 0.1){
                    $("#avgPriceTh").html('Average CGT Price');
                    $("#playerAverageInPrice").html((player.buyValue / player.buyAmount).toFixed(6));
                  } else {
                    $("#avgPriceTh").html('Lose Rate');
                    $("#playerAverageInPrice").html(((player.sellValue + player.burnValue -player.buyValue ) / player.buyValue * 100).toFixed(2) + '%');
                  }
                } else {
                  $("#avgPriceTh").html('Gain Rate');
                  $("#playerAverageInPrice").html(((player.sellValue + player.burnValue -player.buyValue ) / player.buyValue * 100).toFixed(2) + '%');
                }
              } else {
                $("#playerAverageInPrice").html(0);
              }
            }catch (err){
              //result is the error message
              console.log("error:" + err.message)
            }
          }).catch(function (err) {
            console.log("error:" + err.message)
          });

        });
      }

      function setOrder(){
        var skeleton;
        var data;
        var listNum = Math.min(20, buyOrder.length);
        if(buyOrder[buyOrder.length - 1].orderId > lastBuyOrderId){
          lastBuyOrderId = buyOrder[buyOrder.length - 1].orderId;
          $("#buyOrder").html('');
          for(var i = buyOrder.length - 1; i >= buyOrder.length - listNum; i-- ){
            var avatarUrl = '../assets/img/avatar'+ (parseInt(buyOrder[i].playerId) % 7) +'.png';
            var accountUrl;
            if(chainId == 1){
              accountUrl = 'https://explorer.nebulas.io/#/address/' +buyOrder[i].account;
            } else {
              accountUrl = 'https://explorer.nebulas.io/#/testnet/address/' +buyOrder[i].account;
            }
            skeleton = '<tr><td class="user-avatar"> <img src="{{avatarUrl}}" alt="Avatar">Player #{{playerId}}</td><td class="number">{{amount}}</td><td class="number">{{price}}</td><td>{{time}}</td><td class="actions"><button type="submit" class="btn btn-rounded btn-secondary md-trigger" data-modal="form-player" onclick="getPlayerInfo({{account}})"><i class="mdi mdi-account"></i></button></td></tr>';
            data = {avatarUrl: avatarUrl, playerId: buyOrder[i].playerId, account: '"' + buyOrder[i].account.trim() + '"', amount: parseFloat(buyOrder[i].amount).toFixed(2), price: parseFloat(buyOrder[i].price).toFixed(5), time: new Date(buyOrder[i].timeSeconds * 1000).toLocaleString(), url: accountUrl };
            var html = Mustache.to_html(skeleton, data);
            $("#buyOrder").append(html);
          }
        }

        listNum = Math.min(20, sellOrder.length);
        if(sellOrder[sellOrder.length - 1].orderId > lastSellOrderId){
          lastSellOrderId = sellOrder[sellOrder.length - 1].orderId;
          $("#sellOrder").html('');
          for(var i = sellOrder.length - 1; i >= sellOrder.length - listNum; i-- ){
            var avatarUrl = '../assets/img/avatar'+ (parseInt(sellOrder[i].playerId) % 7) +'.png';
            var accountUrl;
            if(chainId == 1){
              accountUrl = 'https://explorer.nebulas.io/#/address/' +sellOrder[i].account;
            } else {
              accountUrl = 'https://explorer.nebulas.io/#/testnet/address/' +sellOrder[i].account;
            }
            skeleton = '<tr><td class="user-avatar"> <img src="{{avatarUrl}}" alt="Avatar">Player #{{playerId}}</td><td class="number">{{amount}}</td><td class="number">{{price}}</td><td>{{time}}</td><td class="actions"><button type="submit" class="btn btn-rounded btn-secondary md-trigger" data-modal="form-player" onclick="getPlayerInfo({{account}})"><i class="mdi mdi-account"></i></button></td></tr>';
            data = {avatarUrl: avatarUrl, playerId: sellOrder[i].playerId, account: '"' + sellOrder[i].account.trim() + '"', amount: parseFloat(sellOrder[i].amount).toFixed(2), price: parseFloat(sellOrder[i].price).toFixed(5), time: new Date(sellOrder[i].timeSeconds * 1000).toLocaleString(), url: accountUrl };
            var html = Mustache.to_html(skeleton, data);
            $("#sellOrder").append(html);
          }
        }

      }

      function login(){
        if(!checkWallet()){
          $("#form-login").modal('show');
          $("#loginAccountAddress").val(address);
        } else {
          if (checkNASWallet()) {
            var fun = 'login';
            var args = [];
            callNebPay(fun, args, 0, function (resp) {
              localStorage.setItem('address', resp.from);
              var wait;
              function clearWait() {
                clearInterval(wait);
                refresh();
              }
              wait = setInterval(clearWait, 2000);
            });
          }
        }
      }

      function setLoginAccount(){

        if(Account.isValidAddress($("#loginAccountAddress").val())){
          loadPlayerAccount();
          address = $("#loginAccountAddress").val();
          localStorage.setItem('address', address);
          $("#form-login").modal('hide');
          $.gritter.add({
            title: "New Notice",
            text: "Your account login succeed",
            time: "",
            class_name: "success clean"
          })
        } else{
          $.gritter.add({
            title: "New Notice",
            text: "Your account address is out of range, please input again.",
            time: "",
            class_name: "warning clean"
          })
        }
      }

      function getBurnOrder(){
        var wait;
        function clearWait() {
          clearInterval(wait);
          $('#burnBtnCancel').click();
          $("#form-burn").prop('hidden', false);
        }
        var burnAmount = parseFloat($("#burnAmount").val());
        if(!burnAmount || burnAmount < 0.01){
          $("#form-burn").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The burn amount is out of range, the minimum burn amount is 0.01.",
            time: "",
            class_name: "warning clean"
          })
        } else if(burnAmount > 1000){
          $("#form-burn").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The burn amount is out of range, the maxmum burn amount is 1000.",
            time: "",
            class_name: "warning clean"
          });
        } else if(cgtBalance > 0 && burnAmount > cgtBalance){
          $("#form-burn").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The burn amount is over your balance, your CGT balance is " + cgtBalance + '.',
            time: "",
            class_name: "warning clean"
          });
        } else {
          var fun = 'burnPrice';
          var args = [];
          args.push(burnAmount);
          innerCall(fun, args, 0, function(params){
            neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
              confirmOrder(resp, function(){
              });
            }).catch(function (err) {
              console.log("error:" + err.message)
            });

          });
        }
      }

      function getBuyOrder(){
        var wait;
        function clearWait() {
          clearInterval(wait);
          $('#buyBtnCancel').click();
          $("#form-buy").prop('hidden', false);
        }
        var value = parseFloat($("#buyValue").val());
        if(!value || value < 0.001){
          $("#form-buy").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The buy value is out of range, the minimum buy value is 0.001.",
            time: "",
            class_name: "warning clean"
          });
        } else if(value > 10) {
          $("#form-buy").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The buy value is out of range, the maximum buy value is 10.",
            time: "",
            class_name: "warning clean"
          })
        } else if(nasBalance > 0 && value > nasBalance){
          $("#form-buy").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The buy value is over your NAS balance, your NAS balance is " + nasBalance + '.',
            time: "",
            class_name: "warning clean"
          });
        } else {
          if(value > 2){

          }

          if(value > 1){
            if(window.mobileAndTabletcheck()){
              $.gritter.add({
                title: "New Notice",
                text: "Mobile buy value should less than 1 NAS ( <= 1NAS)",
                time: "",
                class_name: "warning clean"
              });
            } else {
              $.gritter.add({
                title: "New Notice",
                text: "Please set the GasLimit to 2M wei when you submit the transaction.",
                time: "",
                class_name: "warning clean"
              });
            }
          }

          if(window.mobileAndTabletcheck() && value > 1){
            $("#form-buy").prop('hidden', true);
            wait = setInterval(clearWait, 500);
            return;
          }

          var fun = 'buy';
          var args = [];
          innerCall(fun, args, 0, function(params){
            neb.api.call(params.from.getAddressString(), params.to, value * Math.pow(10, 18), 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
              confirmOrder(resp, function(){
              });
            }).catch(function (err) {
              console.log("error:" + err.message)
            });

          });
        }
      }

      function getSellOrder(){
        var wait;
        function clearWait() {
          clearInterval(wait);
          $('#sellBtnCancel').click();
          $("#form-sell").prop('hidden', false);
        }
        var sellAmount = parseFloat($("#sellAmount").val());
        if(!sellAmount || sellAmount < 0.01){
          $("#form-sell").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The sell amount is out of range, the minimum sell amount is 0.01.",
            time: "",
            class_name: "warning clean"
          });
        } else if(sellAmount > 1000){
          $("#form-sell").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The sell amount is out of range, the maximum sell amount is 1000.",
            time: "",
            class_name: "warning clean"
          });
        } else if(cgtBalance > 0 && sellAmount > cgtBalance){
          $("#form-sell").prop('hidden', true);
          wait = setInterval(clearWait, 500);
          $.gritter.add({
            title: "New Notice",
            text: "The sell amount is over your CGT balance, your CGT balance is " + cgtBalance + '.',
            time: "",
            class_name: "warning clean"
          });
        } else {
          if(sellAmount > 100){
            $.gritter.add({
              title: "New Notice",
              text: "Please set GasLimit th 2M wei when you submit the transaction.",
              time: "",
              class_name: "warning clean"
            });
          }
          var fun = 'sellPrice';
          var args = [];
          args.push(sellAmount);
          innerCall(fun, args, 0, function(params){
            neb.api.call(params.from.getAddressString(), params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
              confirmOrder(resp, function(){
              });
            }).catch(function (err) {
              console.log("error:" + err.message)
            });

          });
        }
      }

      var confirm;

      function confirmOrder(resp, callback){
        var result = resp.result;
        try{
          var order = JSON.parse(result);
          confirm = callback;
          if(order.type == 2){
            $("#burnLabel").html("Burn CGT @ " + order.price.toFixed(6));
            $("#burnAmountConfirm").val(order.amount.toFixed(6));
            $("#burnValueConfirm").val(order.value.toFixed(6));
            $("#burnBtnConfirm").prop('disabled', false);
          } else if(order.type == 1){
            $("#sellLabel").html("Sell CGT @ " + order.price.toFixed(6));
            $("#sellAmountConfirm").val(order.amount.toFixed(6));
            $("#sellValueConfirm").val(order.value.toFixed(6));
            $("#sellBtnConfirm").prop('disabled', false);
          } else if(order.type == 0){
            $("#buyLabel").html("Buy CGT @ " + order.price.toFixed(6));
            $("#buyAmountConfirm").val(order.amount.toFixed(6));
            $("#buyValueConfirm").val(order.value.toFixed(6));
            $("#buyBtnConfirm").prop('disabled', false);
          } else {
          }
        }catch (err){
          $.gritter.add({
            title: "New Notice",
            text: "The nebulas main network is busy.",
            time: "",
            class_name: "warning clean"
          });
        }
      }

      function burnCancel(){
        $("#burnLabel").html("Burn CGT");
        $("#burnAmountConfirm").val('');
        $("#burnValueConfirm").val('');
        $("#burnBtnConfirm").prop('disabled', true);
      }
      function sellCancel(){
        $("#sellLabel").html("Sell CGT");
        $("#sellAmountConfirm").val('');
        $("#sellValueConfirm").val('');
        $("#sellBtnConfirm").prop('disabled', true);
      }
      function buyCancel(){
        $("#buyLabel").html("Buy CGT");
        $("#buyAmountConfirm").val('');
        $("#buyValueConfirm").val('');
        $("#buyBtnConfirm").prop('disabled', true);
      }

      function burn(){
        if (checkNASWallet()) {
          var burnAmount = parseFloat($("#burnAmount").val());
          if(!burnAmount || burnAmount < 0.01){
            $.gritter.add({
              title: "New Notice",
              text: "The burn amount is out of range, the maximum burn amount is 0.01.",
              time: "",
              class_name: "warning clean"
            })
          } else {
            var fun = 'burn';
            var args = [];
            args.push(burnAmount);
            callNebPay(fun, args, 0, function (resp) {
              localStorage.setItem('address', resp.from);
              var wait;
              function clearWait() {
                clearInterval(wait);
                refresh();
              }
              wait = setInterval(clearWait, 2000);
            });
            burnCancel();
          }

        }
      }

      function buy(){
        if (checkNASWallet()) {
          var value = parseFloat($("#buyValue").val());
          if(!value || value < 0.001){
            $.gritter.add({
              title: "New Notice",
              text: "The buy value is out of range, the minimum buy value is 0.001.",
              time: "",
              class_name: "warning clean"
            });
          } else if(value > 10) {
            $.gritter.add({
              title: "New Notice",
              text: "The buy value is out of range, the maximum buy value is 10.",
              time: "",
              class_name: "warning clean"
            })
          } else {
            var fun = 'buy';
            var args = [];
            callNebPay(fun, args, value, function (resp) {
              localStorage.setItem('address', resp.from);
              var wait;
              function clearWait() {
                clearInterval(wait);
                refresh();
              }
              wait = setInterval(clearWait, 2000);
            });
            buyCancel();
          }
        }
      }

      function sell(){
        if (checkNASWallet()) {
          var sellAmount = parseFloat($("#sellAmount").val());
          if(!sellAmount || sellAmount < 0.01){
            $.gritter.add({
              title: "New Notice",
              text: "The sell amount is out of range, the minimum sell amount is 0.01.",
              time: "",
              class_name: "warning clean"
            });
          } else if(sellAmount > 1000){
            $.gritter.add({
              title: "New Notice",
              text: "The sell amount is out of range, the maximum sell amount is 1000.",
              time: "",
              class_name: "warning clean"
            });
          } else {
            var fun = 'sell';
            var args = [];
            args.push(sellAmount);
            callNebPay(fun, args, 0, function (resp) {
              localStorage.setItem('address', resp.from);
              var wait;
              function clearWait() {
                clearInterval(wait);
                refresh();
              }
              wait = setInterval(clearWait, 2000);
            });
            sellCancel();
          }
        }
      }

      function checkWallet(){
        if (typeof (webExtensionWallet) === "undefined") {
          $(document).ready(function () {
            if(window.mobileAndTabletcheck()){
              if(Account.isValidAddress(address)){
                $("#showWalletStatus").removeClass('offline').addClass('online').html('Online by NAS nano');
              } else{
                $("#showWalletStatus").removeClass('online').addClass('offline').html('Please install NAS nano');
              }
            } else{
              $("#showWalletStatus").removeClass('online').addClass('offline').html('No NasExtWallet');
            }
          });
          return false;
        }
        $("#showWalletStatus").removeClass('offline').addClass('online').html('Online by NasExtWallet');
        return true;
      }

      var address = localStorage.getItem('address') || '';
      var addressWallet = '';
      var nasBalance = -1;
      var cgtBalance = -1;

      function loadPlayerAccount(){
        window.addEventListener('message', function (e) {
          if (e.data.data && !!e.data.data.account) {
            addressWallet = e.data.data.account;
            if(checkWallet()){
              address = addressWallet;
              localStorage.setItem('address', address);
            }
          }

          if(Account.isValidAddress(address)){
            $('#playerData').click(function(){
              getPlayerInfo(address);
            });
            try {
              neb.api.getAccountState(address).then(function(accstate){
                $("#accountBalance").html(' ' + Unit.fromBasic(accstate.balance, "nas").toFixed(2) + ' NAS');
                nasBalance = Unit.fromBasic(accstate.balance, "nas").toFixed(2);
                var fun = 'balanceOf';
                var args = [];

                args.push(address);
                innerCall(fun, args, 0, function(params){
                  neb.api.call(address, params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
                    var result = resp.result;
                    if(result === 'null' || result === '""'){
                      return;
                    }
                    try{
                      var balance = JSON.parse(result);
                      $("#accountTokenBalance").html(' ' + Unit.fromBasic(balance, "nas").toFixed(2) + ' CGT');
                      cgtBalance = Unit.fromBasic(balance, "nas").toFixed(2);
                      var fun = 'player';
                      var args = [];
                      args.push(address);
                      innerCall(fun, args, 0, function(params){
                        neb.api.call(address, params.to, params.value, 0, params.gasPrice, params.gasLimit, params.contract).then(function (resp) {
                          var result = resp.result;
                          if(result === 'null' || result === '""'){
                            return;
                          }
                          try{
                            var player = JSON.parse(result);
                            if(player.account !== ''){
                              $("#avatarImg").prop('src', "../assets/img/avatar" + player.playerId % 7 + ".png");
                              $(".user-name").html('Player #' + player.playerId);
                            } else {
                              $(".user-name").html('New Player');
                            }
                          }catch (err){
                            //result is the error message
                            console.log("error:" + err.message)
                          }
                        }).catch(function (err) {
                          console.log("error:" + err.message)
                        });

                      });

                    }catch (err){
                      //result is the error message
                      console.log("error:" + err.message)
                    }
                  }).catch(function (err) {
                    console.log("error:" + err.message)
                  });

                });

              })
            } catch (err){
              console.log(err);
            }

          }

        });

        window.postMessage({
          "target": "contentscript",
          "data": {},
          "method": "getAccount",
        }, "*");
      }

      var playerNum = 0;
      var circulation = 0;
      var contractTokenBalance = 0;
      var volume = 0;
      var price = 0;
      var balance = 0;
      var insureBalance = 0;

      var buyPriceTrend = [];
      var sellPriceTrend = [];
      var burnPriceTrend = [];
      var buyOrder = [];
      var sellOrder = [];
      var burnOrder = [];
      var lastBuyOrderId = 0;
      var lastSellOrderId = 0;

      function load(){
        var e = $(".main-content");
        e.length && (e.addClass("be-loading-active"));
        checkWallet();
        getPrice();
        loadPlayerAccount();
        getContractTokenBalance();

        getBuyVolume(function(){
          getSellVolume(function(){
            getBurnVolume(function(){
              setOrder();
            });
          });
        });

        getPlayerNum(function(result){
          playerNum = parseInt(result);
          $("#playerNum").attr('data-end', playerNum);
          getCirculation(function(result){
            circulation = parseInt(Unit.fromBasic(result, 'nas'));
            $("#circulation").attr('data-end', circulation);
            if(parseInt(contractTokenBalance) > 0){
              $(".progress-value").html(parseInt(circulation / 400000 * 100) + '%, ' + parseInt((circulation + parseInt(contractTokenBalance)) / 400000 * 100) + '%');
            } else {
              $(".progress-value").html(parseInt(circulation / 400000 * 100) + '%');
            }
            $("#progressCirculation").css('width', parseInt(circulation / 400000 * 100) + '%');
            $("#progressTotalSupply").css('width', parseInt(contractTokenBalance / 400000 * 100) + '%');
            getBuyVolume(function(){
              getSellVolume(function(){
                getBurnVolume(function(){
                  $("#volume").attr('data-end', volume);
                  $('#marketCap').attr('data-end', parseInt(price * circulation));
                  getBalance(function(_balance){
                    balance = parseInt(Unit.fromBasic(_balance, 'nas'));
                    $("#balance").html(balance);
                    try{
                      $("#contractBalance").html(' ' + balance + " NAS");
                    } catch (e){
                      console.log(e)
                    }
                    getInsureBalance(function(_balance){
                      try{
                        insureBalance = parseInt(Unit.fromBasic(_balance, 'nas'));
                        $("#insureBalance").html(insureBalance);
                        $("#contractInsureBalance").html(' ' + insureBalance + ' NAS');
                      } catch (e){
                        console.log(e)
                      }
                      setOrder();
                      var _buyPriceTrend = buyPriceTrend;
                      buyPriceTrend = [];
                      if(_buyPriceTrend.length > 50){
                        var sInterval = parseInt(_buyPriceTrend.length / 50);
                        for(var i = 0; i < 50; i++){
                          buyPriceTrend[i] = _buyPriceTrend[i * sInterval];
                        }
                      }

                      var e = $(".main-content");
                      e.removeClass("be-loading-active");

                      var e, t, i, a, o, n, r, l, s, c, d, p, u, h, f, g, m, b;
                      e = App.color.primary, t = App.color.warning, i = App.color.success, a = App.color.danger;
                      n = App.color.primary, r = tinycolor(App.color.primary).lighten(13).toString(), l = tinycolor(App.color.primary).lighten(20).toString();

                      $('[data-toggle="counter"]').each(function (e, t) {
                        var i = $(this), a = "", o = "", n = 0, r = 0, l = 0, s = 2.5;
                        i.data("prefix") && (a = i.data("prefix")), i.data("suffix") && (o = i.data("suffix")), i.data("start") && (n = i.data("start")), i.data("end") && (r = i.data("end")), i.data("decimals") && (l = i.data("decimals")), i.data("duration") && (s = i.data("duration")), new CountUp(i.get(0), n, r, l, s, {
                          suffix: o,
                          prefix: a
                        }).start()
                      }), $(".toggle-loading").on("click", function () {
                        var e = $(this).parents(".widget, .panel");
                        e.length && (e.addClass("be-loading-active"), setTimeout(function () {
                          e.removeClass("be-loading-active")
                        }, 3e3))
                      }), e = App.color.primary, t = App.color.warning, i = App.color.success, a = App.color.danger, $("#spark1").sparkline([0, 5, 3, 7, 5, 10, 3, 6, 5, 10], {
                        width: "85",
                        height: "35",
                        lineColor: e,
                        highlightSpotColor: e,
                        highlightLineColor: e,
                        fillColor: !1,
                        spotColor: !1,
                        minSpotColor: !1,
                        maxSpotColor: !1,
                        lineWidth: 1.15
                      }), $("#spark2").sparkline([5, 8, 7, 10, 9, 10, 8, 6, 4, 6, 8, 7, 6, 8], {
                        type: "bar",
                        width: "85",
                        height: "35",
                        barWidth: 3,
                        barSpacing: 3,
                        chartRangeMin: 0,
                        barColor: t
                      }), $("#spark3").sparkline([2, 3, 4, 5, 4, 3, 2, 3, 4, 5, 6, 5, 4, 3, 4, 5, 6, 5, 4, 4, 5], {
                        type: "discrete",
                        width: "85",
                        height: "35",
                        lineHeight: 20,
                        lineColor: i,
                        xwidth: 18
                      }), $("#spark4").sparkline([2, 5, 3, 7, 5, 10, 3, 6, 5, 7], {
                        width: "85",
                        height: "35",
                        lineColor: a,
                        highlightSpotColor: a,
                        highlightLineColor: a,
                        fillColor: !1,
                        spotColor: !1,
                        minSpotColor: !1,
                        maxSpotColor: !1,
                        lineWidth: 1.15
                      });

                      $('[data-color="main-chart-color1"]').css({"background-color": n}), $('[data-color="main-chart-color2"]').css({"background-color": r}), $('[data-color="main-chart-color3"]').css({"background-color": l}), s = App.color.success, c = App.color.warning, d = App.color.primary, $.plot("#top-sales", [{
                        label: "Services",
                        data: balance
                      }, {label: "Standard Plans", data: insureBalance}, {label: "Services", data: 0}], {
                        series: {
                          pie: {
                            radius: .75,
                            innerRadius: .58,
                            show: !0,
                            highlight: {opacity: .1},
                            label: {show: !1}
                          }
                        }, grid: {hoverable: !0}, legend: {show: !1}, colors: [s, c, d]
                      });

                      setInterval(refreshData, 35000);
                    })
                  });
                });
              });
            });
          });
        });
      }

      load();

      function refreshData(){
        // Wait
        var prePlayerNum = parseInt(playerNum);
        var preCirculation = parseInt(circulation);
        var preVolume = parseInt(volume);
        var preMarketCap = parseInt(price * circulation);

        volume = 0;

        buyPriceTrend = [];
        buyOrder = [];
        sellOrder = [];
        burnOrder = [];

        getPrice();
        loadPlayerAccount();
        getContractTokenBalance();

        getBuyVolume(function(){
          getSellVolume(function(){
            getBurnVolume(function(){
              setOrder();
            });
          });
        });

        getPlayerNum(function(result){
          playerNum = parseInt(result);
          $("#playerNum").attr('data-end', playerNum);
          getCirculation(function(result){
            circulation = parseInt(Unit.fromBasic(result, 'nas'));
            $("#circulation").attr('data-end', circulation);
            if(parseInt(contractTokenBalance) > 0){
              $(".progress-value").html(parseInt(circulation / 400000 * 100) + '%, ' + parseInt((circulation + parseInt(contractTokenBalance)) / 400000 * 100) + '%');
            } else {
              $(".progress-value").html(parseInt(circulation / 400000 * 100) + '%');
            }
            $("#progressCirculation").css('width', parseInt(circulation / 400000 * 100) + '%');
            $("#progressTotalSupply").css('width', parseInt(contractTokenBalance / 400000 * 100) + '%');
            getBuyVolume(function(){
              getSellVolume(function(){
                setOrder();
                getBurnVolume(function(){
                  $("#volume").attr('data-end', parseInt(volume));
                  $('#marketCap').attr('data-end', parseInt(price * circulation));
                  getBalance(function(_balance){
                    balance = parseInt(Unit.fromBasic(_balance, 'nas'));
                    $("#balance").html(balance);
                    try{
                      $("#contractBalance").html(' ' + balance + " NAS");
                    } catch (e){
                      console.log(e)
                    }
                    getInsureBalance(function(balance){
                      try{
                        insureBalance = parseInt(Unit.fromBasic(balance, 'nas'));
                        $("#insureBalance").html(insureBalance);
                        $("#contractInsureBalance").html(' ' + insureBalance + ' NAS');
                      } catch (e){
                        console.log(e)
                      }
                      $("#playerNum").html(prePlayerNum);
                      $("#circulation").html(preCirculation);
                      $("#volume").html(preVolume);
                      $('#marketCap').html(preMarketCap);
                      $('[data-toggle="counter"]').each(function (e, t) {
                        var i = $(this), a = "", o = "", n = 0, r = 0, l = 0, s = 2.5;
                        i.data("prefix") && (a = i.data("prefix")), i.data("suffix") && (o = i.data("suffix")), i.data("start") && (n = i.data("start")), i.data("end") && (r = i.data("end")), i.data("decimals") && (l = i.data("decimals")), i.data("duration") && (s = i.data("duration")), new CountUp(i.get(0), n, r, l, s, {
                          suffix: o,
                          prefix: a
                        }).start()});
                    })
                  });
                });
              });
            });
          });
        });

      };

      var isWx = Boolean(navigator.userAgent.match(/MicroMessenger/ig));
      if(isWx){
        $.gritter.add({
          title: "New Notice",
          text: "微信浏览器可能不支持NAS nano调用, 请点击右上方的三个小点, 并选择用浏览器打开!",
          time: "",
          class_name: "warning clean"
        });
      }

      $(document).ready(function() {
        $.fn.niftyModal('setDefaults', {
          overlaySelector: '.modal-overlay',
          contentSelector: '.modal-content',
          closeSelector: '.modal-close',
          classAddAfterOpen: 'modal-show'
        });

        App.init();
        $.gritter.add({
          title: "New Notice",
          text: "Take part in the game，share 20% of winner bounty，the exciting experience and huge bounty is waiting for you！",
          time: "",
          class_name: "clean"
        });
      });

    </script>

  </body>

  <div id="form-login" class="modal fade colored-header colored-header-primary" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Please Input Your Account Address</h4>
        </div>
        <div class="modal-body">
          <label>Account Address</label>
          <input type="text" class="form-control input-group-sm" id="loginAccountAddress">
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="setLoginAccount()">Confirm</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->



  <div id="form-player" class="modal fade colored-header colored-header-primary" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Player #<b id="playerId"></b> Game Data</h4>
        </div>
        <div class="modal-body text-left">
          <div class="card-body table-responsive">
            <table class="table table-striped table-borderless">
              <thead>
              <tr>
                <th class="number">CGT Balance</th>
                <th class="number">CGT Buy</th>
                <th class="number">CGT Sell</th>
                <th class="number">CGT Burn</th>
              </tr>
              </thead>
              <tbody class="no-border-x">
              <tr>
                <td class="number" id="playerTokenBalance"></td>
                <td class="number" id="playerBuyAmount"></td>
                <td class="number" id="playerSellAmount"></td>
                <td class="number" id="playerBurnAmount"></td>
              </tr>
              </tbody>

              <thead>
              <tr>
                <th class="number">Cost NAS</th>
                <th class="number">Sell Get NAS</th>
                <th class="number">Burn Get NAS</th>
                <th class="number" id="avgPriceTh"></th>
              </tr>
              </thead>
              <tbody class="no-border-x">
              <tr>
                <td class="number" id="playerBuyValue"></td>
                <td class="number" id="playerSellValue"></td>
                <td class="number" id="playerBurnValue"></td>
                <td class="number" id="playerAverageInPrice"></td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer"  style="padding-top: 10px">
          <br>
          <button type="button" data-dismiss="modal" class="btn btn-success modal-close" onclick="resetPlayerInfo()">关闭</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div class="be-loading text-">
    <!-- Here goes your content -->
    <div class="be-spinner">
      <svg width="40px" height="40px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
        <circle fill="none" stroke-width="4" stroke-linecap="round" cx="33" cy="33" r="30" class="circle"></circle>
      </svg>
    </div>
  </div>
</html>